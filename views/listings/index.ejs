<% layout("/layouts/boilerplate") %>
<link rel="stylesheet" href="/css/filter.css">
<div class="filters-main">
    <div id="filters">
        <div class="left_img_button" id="slideButton" style="display: none;">
            <i class="fa-solid fa-angle-left"></i>
        </div>
        <a href="/listings/">
            <div class="filter ALL ps-2 pe-2">
                <div><img src="/Icon/0.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p style="text-decoration: none;">ALL</p>
            </div>
        </a>
        <a href="/listings/filter/Trending">
            <div class="filter Trending">
                <div><img src="/Icon/14.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Trending</p>
            </div>
        </a>
        <a href="/listings/filter/Beachfront">
            <div class="filter Beachfront">
                <div><img src="/Icon/1.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Beachfront</p>
            </div>
        </a>
        <a href="/listings/filter/Cabins">
            <div class="filter Cabins">
                <div><img src="/Icon/2.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>&nbsp;Cabins&nbsp;</p>
            </div>
        </a>
        <a href="/listings/filter/Omg">
            <div class="filter OMG">
                <div><img src="/Icon/3.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>&nbsp;OMG!&nbsp;</p>
            </div>
        </a>
        <a href="/listings/filter/Lake">
            <div class="filter Lake">
                <div><img src="/Icon/4.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>&nbsp;Lake&nbsp;</p>
            </div>
        </a>
        <a href="/listings/filter/Design">
            <div class="filter Design">
                <div><img src="/Icon/5.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>&nbsp;Design&nbsp;</p>
            </div>
        </a>
        <a href="/listings/filter/Amazing Pools">
            <div class="filter Amazing-pools">
                <div><img src="/Icon/6.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Amazing pools</p>
            </div>
        </a>
        <a href="/listings/filter/Farms">
            <div class="filter Farms">
                <div><img src="/Icon/7.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>&nbsp;Farms&nbsp;</p>
            </div>
        </a>
        <a href="/listings/filter/Amazing Views">
            <div class="filter Amazing-views">
                <div><img src="/Icon/8.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Amazing views</p>
            </div>
        </a>
        <a href="/listings/filter/Rooms">
            <div class="filter Rooms">
                <div><img src="/Icon/9.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>&nbsp;Rooms&nbsp;</p>
            </div>
        </a>
        <a href="/listings/filter/Lakefront">
            <div class="filter Lakefront">
                <div><img src="/Icon/10.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Lakefront</p>
            </div>
        </a>
        <a href="/listings/filter/Tiny Homes">
            <div class="filter Tiny-homes">
                <div><img src="/Icon/11.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Tiny homes</p>
            </div>
        </a>
        <a href="/listings/filter/Countryside">
            <div class="filter Countryside">
                <div><img src="/Icon/12.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Countryside</p>
            </div>
        </a>
        <a href="/listings/filter/Treehouse">
            <div class="filter Treehouse">
                <div><img src="/Icon/13.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Treehouse</p>
            </div>
        </a>
        <a href="/listings/filter/Tropical">
            <div class="filter Tropical">
                <div><img src="/Icon/15.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Tropical</p>
            </div>
        </a>
        <a href="/listings/filter/National Parks">
            <div class="filter National-parks">
                <div><img src="/Icon/16.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>National parks</p>
            </div>
        </a>
        <a href="/listings/filter/Castles">
            <div class="filter Castles">
                <div><img src="/Icon/17.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Castles</p>
            </div>
            </a>
        <a href="/listings/filter/Camping">
            <div class="filter Camping">
                <div><img src="/Icon/18.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Camping</p>
            </div>
            </a>
        <a href="/listings/filter/Top Of The World">
            <div class="filter Top-of-the-world">
                <div><img src="/Icon/19.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Top of the world</p>
            </div>
            </a>
        <a href="/listings/filter/Luxe">
            <div class="filter Luxe">
                <div><img src="/Icon/20.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>&nbsp;Luxe&nbsp;</p>
            </div>
            </a>
        <a href="/listings/filter/Iconic Cities">
            <div class="filter Iconic-cities">
                <div><img src="/Icon/21.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Iconic cities</p>
            </div>
            </a>
        <a href="/listings/filter/Earth Homes">
            <div class="filter Earth-homes">
                <div><img src="/Icon/22.png" alt="icon" style="width: 25px; height: 25px;"></div>
                <p>Earth homes</p>
            </div>
        </a>
        <div class="right_img_button" id="slideButton">
            <i class="fa-solid fa-angle-right"></i>
        </div>
    </div>

    <div class="tax-toggle tax-filter ">
        <div class="form-check form-switch form-check-reverse" >
            <input class="form-check-input tax-switch shadow-none" type="checkbox" role="switch" id="flexSwitchCheckDefault" style="cursor: pointer;">
            <label class="form-check-label changeAfter" for="flexSwitchCheckDefault" style="cursor: pointer; margin-top: 3px; ">Display tax inclusive prices</label>
        </div>
    </div>
</div>
<div class="tax-toggle tax-sticky">
    <div class="form-check form-switch form-check-reverse">
        <input class="form-check-input tax-switch tax-sticky-sticky shadow-none" type="checkbox" role="switch" id="flexSwitchCheckDefaultS" style="cursor: pointer;">
        <label class="form-check-label changeAfter" for="flexSwitchCheckDefaultS" style="cursor: pointer;">Display tax inclusive prices</label>
    </div>
</div>

  <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
    <% for(let listing of allListings){ %>
    <a href="/listings/<%= listing._id %>" class="listing-link" data-category="<%= listing.category %>">
      <div class="card col listing-card">
        <img
          src="<%= listing.image.url %>"
          class="card-img-top"
          alt="listing_image"
          style="height: 20rem"
        />
        <div class="card-img-overlay"></div>
        <!-- <div class="card-body">
          <p class="card-text">
            <b><%= listing.title %></b>
            <br>  
             &#8377; <%= listing.price ? listing.price.toLocaleString("en-IN") : 'Price not available' %> / night
             <i class="tax-info"> &nbsp;&nbsp;&nbsp;     GST 18% Extra</i> 
          </p>
        </div> -->
        <div class="card-body">
            <p class="card-text">

               <b>
                  <%= listing.title %>
               </b><br>
               <!-- &#8377; <#%= listing.price %> / Night<br> -->
               <!-- &#8377; <%= listing.price.toLocaleString("en-IN") %> / Night<br>
                  <i class="text-info"> &nbsp; &nbsp; +18% GST</i> -->
                  <%
                    // Generate day as one of 2, 3, 4, 5
                    let day = Math.floor(Math.random() * 4 + 2); // Random number between 2 and 5

                    // Generate `date` such that `dateA` will be less than 28
                    let baseDate = new Date('2023-11-01');
                    let baseDay = baseDate.getDate(); // This is 1

                    // Ensure that `dateA` is less than 28 and `dateA - date` equals `day`
                    let date, dateA;

                    do {
                         // Generate `no` such that the sum of baseDay, no, and day is within range
                        no = Math.floor(Math.random() * (28 - day - baseDay + 1)); // Adjust range to ensure valid dateA
  
                        date = baseDay + no;
                        dateA = date + day;
                        } while (dateA > 27); // Repeat until `dateA` is within the valid range

                    // Get the current month
                    let month = new Date().toDateString().split(" ")[1];
                   %>

                  <span style="display: block;"><span class="tax-info">&nbsp;<%= day %> nights  &nbsp;•&nbsp;</span> <%= date %>&nbsp;-&nbsp;<%- dateA %> &nbsp;&nbsp;<%= month %></span>
                  <span class="price-info"><span class=" fw-bold">&nbsp;&#8377;<%= listing.price.toLocaleString("en-IN") %> </span>  </span>
                  <i class="tax-info tax-underline ms-1"><i class="rs-sign"><b> &#8377;</i><%= (listing.price*1.18).toLocaleString("en-In") %></b> – all taxes included</i>
            </p>
         </div>

      </div>
    </a>

    <% } %>
  </div>

  <!-- <script>
    document.addEventListener('DOMContentLoaded', function() {
        const filters = document.querySelectorAll('.filter');
        const listings = document.querySelectorAll('.listing-link');
        const searchInput = document.getElementById('searchInput');
        console.log(searchInput);

        function filterListings() {
        const searchValue = searchInput.value.trim().toLowerCase(); // Get search input value and normalize
        
        listings.forEach(listing => {
            const listingTitle = listing.querySelector('.card-text b').textContent.toLowerCase(); // Get listing title
            
            // Show or hide listing based on whether it includes the search value
            if (listingTitle.includes(searchValue) || searchValue === '') {
                listing.style.display = 'block'; // Show the listing
            } else {
                listing.style.display = 'none'; // Hide the listing
            }
        });
    }

    // Event listener for search input
    searchInput.addEventListener('input', filterListings);

        filters.forEach(filter => {
            filter.addEventListener('click', function() {
                const selectedCategory = this.getAttribute('data-category');
                
                if (selectedCategory === 'Trending') {
                    // Show all listings if 'Trending' filter is clicked
                    listings.forEach(listing => {
                        listing.style.display = 'block';
                    });
                } else {
                    // Filter listings based on selected category
                    listings.forEach(listing => {
                        const listingCategory = listing.getAttribute('data-category');
                        if (selectedCategory === 'all' || selectedCategory === listingCategory) {
                                listing.style.display = 'block'; // Show the listing
                        } else {
                            listing.style.display = 'none'; // Hide the listing
                        }
                    });
                }
            });
        });

        // Show all listings initially
        document.querySelector('.filter[data-category="all"]').click();
    });

    let taxSwitch = document.getElementById('flexSwitchCheckDefault');
    taxSwitch.addEventListener("click", () => {
        let taxInfo = document.getElementsByClassName('tax-info');
        for(info of taxInfo){
            if(info.style.display != "inline"){
                info.style.display = "inline";
            }else{
               info.style.display = "none";
            }
        }

    })
</script> -->

<script src="/js/filter.js"></script>
<script src="/js/tax.js"></script>
